import{f as I}from"./QPopupEdit.a6b8c25e.js";import{C}from"./ClosePopup.7b950a27.js";import{_ as j,y as q,r as d,o as c,d as w,ab as s,w as m,g as l,t as i,aN as b,aR as $,c as f,f as n,B as D,n as N,a_ as M}from"./index.efdacdc2.js";const P={emits:["update:modelValue"],props:{modelValue:{type:Object,default:()=>({})}},setup(e,{emit:t}){const r=q(e.modelValue);q([]);const a=q({open:!1,loading:!1,data:{id:null,type:null,first_name:null,last_name:null,phone:null,birth_date:null}});function o(){a.value.open=!0,a.value.data={id:r.value.id,type:r.value.type,first_name:r.value.first_name,last_name:r.value.last_name,phone:r.value.phone,birth_date:r.value.birth_date}}async function u(){a.value.loading=!0,n.clearErrors();const _=await n.store.dispatch("users/update",a.value.data);_.status?(a.value.open=!1,n.$q.notify({type:"positive",message:n.locale.t("globals.saved")}),r.value={...r.value,..._.user||{}},t("update:modelValue",r.value)):_.statusCode==422?n.setErrors(_.errors):n.$q.notify({type:"negative",message:n.locale.t("globals.errors.unknown")}),a.value.loading=!1}return{user:r,editing:a,open_edit:o,save:u}}},R={class:"column full-width"},S={key:0,class:"row q-pa-md justify-end"},O={class:"text-h6 q-mr-auto"};function Q(e,t,r,a,o,u){const _=d("ap-markup-table"),v=d("ap-button"),U=d("ap-dialog-header"),y=d("ap-select"),h=d("ap-input"),V=d("ap-date-picker"),k=d("ap-card-section"),z=d("ap-dialog-card"),E=d("ap-dialog");return c(),w("div",R,[s(_,{flat:""},{default:m(()=>[l("tbody",null,[l("tr",null,[l("td",null,i(e.$t("globals.user_fields.first_name")),1),l("td",null,i(a.user.first_name),1)]),l("tr",null,[l("td",null,i(e.$t("globals.user_fields.last_name")),1),l("td",null,i(a.user.last_name),1)]),l("tr",null,[l("td",null,i(e.$t("globals.user_fields.phone")),1),l("td",null,i(a.user.phone||"-"),1)]),l("tr",null,[l("td",null,i(e.$t("globals.user_fields.email")),1),l("td",null,i(a.user.email),1)]),l("tr",null,[l("td",null,i(e.$t("globals.user_fields.type")),1),l("td",null,i(e.$t(`globals.user_types.${a.user.type}`)),1)]),l("tr",null,[l("td",null,i(e.$t("globals.user_fields.age")),1),l("td",null,i(a.user.age),1)]),l("tr",null,[l("td",null,i(e.$t("globals.user_fields.birth_date")),1),l("td",null,i(a.user.birth_date?e.nice_date(a.user.birth_date):"-"),1)])])]),_:1}),a.user.type=="admin"?(c(),w("div",S,[s(v,{outline:"",icon:"edit",label:e.$t("globals.edit"),color:"primary",onClick:a.open_edit},null,8,["label","onClick"])])):b("",!0),s(E,{modelValue:a.editing.open,"onUpdate:modelValue":t[5]||(t[5]=p=>a.editing.open=p)},{default:m(()=>[s(z,null,{default:m(()=>[s(U,null,{default:m(()=>[l("span",O,i(e.$t("globals.edit")),1),$(s(v,{round:"",flat:"",icon:"close",size:"12px"},null,512),[[C]])]),_:1}),s(k,{class:"row q-col-gutter-md"},{default:m(()=>[e.$user.type=="admin"?(c(),f(y,{key:0,class:"col-xs-12",label:e.$t("globals.user_fields.type"),options:e.lists.user_types.value,modelValue:a.editing.data.type,"onUpdate:modelValue":t[0]||(t[0]=p=>a.editing.data.type=p),"map-options":"","emit-value":"",validate:"type"},null,8,["label","options","modelValue"])):b("",!0),s(h,{modelValue:a.editing.data.first_name,"onUpdate:modelValue":t[1]||(t[1]=p=>a.editing.data.first_name=p),class:"col-xs-12 col-sm-6",label:e.$t("globals.user_fields.first_name"),validate:"first_name"},null,8,["modelValue","label"]),s(h,{modelValue:a.editing.data.last_name,"onUpdate:modelValue":t[2]||(t[2]=p=>a.editing.data.last_name=p),class:"col-xs-12 col-sm-6",label:e.$t("globals.user_fields.last_name"),validate:"last_name"},null,8,["modelValue","label"]),s(h,{modelValue:a.editing.data.phone,"onUpdate:modelValue":t[3]||(t[3]=p=>a.editing.data.phone=p),class:"col-xs-12 col-sm-6",label:e.$t("globals.user_fields.phone"),validate:"phone"},null,8,["modelValue","label"]),s(V,{modelValue:a.editing.data.birth_date,"onUpdate:modelValue":t[4]||(t[4]=p=>a.editing.data.birth_date=p),class:"col-xs-12 col-sm-6",label:e.$t("globals.user_fields.birth_date"),validate:"birth_date"},null,8,["modelValue","label"])]),_:1}),s(k,{class:"row justify-between"},{default:m(()=>[$(s(v,{flat:"",label:e.$t("globals.cancel")},null,8,["label"]),[[C]]),s(v,{color:"primary",label:e.$t("globals.continue"),loading:e.state.loading,onClick:a.save},null,8,["label","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var A=j(P,[["render",Q]]);const F={components:{Info:A},setup(){const e=q({is_adding:!1,loaded:!1,loading:!1,disabled:!1,status_loading:!1,page:"info",user:{id:null}});D(()=>{var u;const o=(u=n.router.currentRoute.value.params)==null?void 0:u.id;o&&t(o)});async function t(o){e.value.loading=!0;const u=await n.store.dispatch("users/show",{id:o});u.status?e.value.user=u.user:n.$q.notify({color:"negative",message:n.locale.t("globals.errors.unknown")}),e.value.loaded=!0,e.value.loading=!1}async function r(){var u,_;e.value.loading=!0,n.clearErrors();let o=null;e.value.is_adding?o=await n.store.dispatch(`${base_store}/store`,e.value.data):o=await n.store.dispatch(`${base_store}/update`,e.value.data),o.status?done():o.statusCode==422?((_=(u=o.errors)==null?void 0:u.content)!=null&&_.length&&n.$q.notify({color:"negative",message:o.errors.content[0]}),n.setErrors(o.errors)):n.$q.notify({color:"negative",message:n.locale.t("globals.errors.unknown")}),e.value.loading=!1}async function a(o){e.value.status_loading=!0,(await n.store.dispatch("users/update_status",{id:e.value.user.id,status:o})).status&&(e.value.user.status=o),e.value.status_loading=!1}return{state:e,save:r,update_status:a}}},G={class:"column items-center no-wrap text-center"},H={class:"text-h6"},J=l("div",{class:"row no-wrap q-gap-lg"},null,-1),K={key:0,class:"row items-center q-gap-sm text-weight-bold cursor-pointer"},L={key:0,class:"text-positive"},T={key:1,class:"text-negative"},W={class:"column q-gap-md"},X={class:"row items-center q-gap-md"};function Y(e,t,r,a,o,u){const _=d("ap-img"),v=d("ap-icon"),U=d("ap-avatar"),y=d("ap-button"),h=d("ap-select"),V=d("ap-card-section"),k=d("Info"),z=d("ap-card"),E=d("ap-page-loader"),p=d("ap-page");return c(),f(p,null,{default:m(()=>[a.state.loaded?(c(),f(z,{key:0},{default:m(()=>[s(V,{horizontal:e.$q.screen.gt.xs,"no-padding":"",class:"q-gap-lg items-start overflow-hidden"},{default:m(()=>[s(V,{class:N(["flex-shrink column flex-center q-my-lg q-gap-md",{"q-mx-xl q-pa-none":e.$q.screen.gt.xs,"q-px-sm":e.$q.screen.lt.sm}])},{default:m(()=>[s(U,{bordered:"",size:"100px"},{default:m(()=>[a.state.user.avatar?(c(),f(_,{key:0,src:e.media(a.state.user.avatar,"s"),fit:"cover",class:"fit cursor-pointer",onClick:t[0]||(t[0]=M(g=>e.open_media_popup(e.media(a.state.user.avatar)),["stop","prevent"]))},null,8,["src"])):(c(),f(v,{key:1,name:"sym_o_person",color:"grey-6"}))]),_:1}),l("div",G,[l("span",H,i(a.state.user.full_name),1)]),J,a.state.user.type!="admin"&&a.state.user.id!=e.$user.id?(c(),w("span",K,[s(y,{round:"",size:"xs",icon:"sym_o_edit"}),a.state.user.status=="active"?(c(),w("span",L,i(e.$t("globals.active")),1)):b("",!0),a.state.user.status=="archived"?(c(),w("span",T,i(e.$t("globals.archived")),1)):b("",!0),s(I,{modelValue:a.state.user.status,"onUpdate:modelValue":t[1]||(t[1]=g=>a.state.user.status=g),class:"q-pa-md"},{default:m(g=>[l("div",W,[s(h,{modelValue:g.value,"onUpdate:modelValue":B=>g.value=B,options:e.lists.user_statuses.value,"map-options":"","emit-value":"",label:e.$t("globals.status"),style:{"min-width":"200px"}},null,8,["modelValue","onUpdate:modelValue","options","label"]),l("div",X,[$(s(y,{flat:"",label:e.$t("globals.close"),class:"q-mr-auto"},null,8,["label"]),[[C]]),$(s(y,{color:"primary",label:e.$t("globals.save"),loading:a.state.status_loading,onClick:B=>a.update_status(g.value)},null,8,["label","loading","onClick"]),[[C]])])])]),_:1},8,["modelValue"])])):b("",!0)]),_:1},8,["class"]),s(V,{class:"q-py-none full-width overflow-hidden","no-padding":""},{default:m(()=>[l("div",{class:N(["column full-width",{"q-py-sm":e.$q.screen.gt.xs,"q-pa-md":e.$q.screen.lt.sm}])},[a.state.page=="info"?(c(),f(k,{key:0,modelValue:a.state.user,"onUpdate:modelValue":t[2]||(t[2]=g=>a.state.user=g)},null,8,["modelValue"])):b("",!0)],2)]),_:1})]),_:1},8,["horizontal"])]),_:1})):(c(),f(E,{key:1}))]),_:1})}var ae=j(F,[["render",Y]]);export{ae as default};
